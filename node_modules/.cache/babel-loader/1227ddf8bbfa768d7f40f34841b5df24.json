{"remainingRequest":"C:\\Users\\Brezgo-1098\\Desktop\\brezz\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\Brezgo-1098\\Desktop\\brezz\\src\\logic\\webrtc.js","dependencies":[{"path":"C:\\Users\\Brezgo-1098\\Desktop\\brezz\\src\\logic\\webrtc.js","mtime":1587032502000},{"path":"C:\\Users\\Brezgo-1098\\Desktop\\brezz\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Brezgo-1098\\Desktop\\brezz\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudmFsdWVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkM6XFxVc2Vyc1xcQnJlemdvLTEwOThcXERlc2t0b3BcXGJyZXp6XFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyBmcm9tICJDOlxcVXNlcnNcXEJyZXpnby0xMDk4XFxEZXNrdG9wXFxicmV6elxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0V2l0aG91dFByb3BlcnRpZXMiOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICJDOlxcVXNlcnNcXEJyZXpnby0xMDk4XFxEZXNrdG9wXFxicmV6elxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiQzpcXFVzZXJzXFxCcmV6Z28tMTA5OFxcRGVza3RvcFxcYnJlenpcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQgZnJvbSAiQzpcXFVzZXJzXFxCcmV6Z28tMTA5OFxcRGVza3RvcFxcYnJlenpcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2Fzc2VydFRoaXNJbml0aWFsaXplZCI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQzpcXFVzZXJzXFxCcmV6Z28tMTA5OFxcRGVza3RvcFxcYnJlenpcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICJDOlxcVXNlcnNcXEJyZXpnby0xMDk4XFxEZXNrdG9wXFxicmV6elxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vaW5oZXJpdHMiOwppbXBvcnQgX2NyZWF0ZVN1cGVyIGZyb20gIkM6XFxVc2Vyc1xcQnJlemdvLTEwOThcXERlc2t0b3BcXGJyZXp6XFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVTdXBlciI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiQzpcXFVzZXJzXFxCcmV6Z28tMTA5OFxcRGVza3RvcFxcYnJlenpcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2RlZmluZVByb3BlcnR5IjsKLy8gQ29weXJpZ2h0IChjKSAyMDIwIERpcmsgSG9sdHdpY2suIEFsbCByaWdodHMgcmVzZXJ2ZWQuIGh0dHBzOi8vaG9sdHdpY2suZGUvY29weXJpZ2h0CmltcG9ydCBpbyBmcm9tICdzb2NrZXQuaW8tY2xpZW50JzsKaW1wb3J0IHsgU0lHTkFMX1NFUlZFUl9VUkwgfSBmcm9tICcuLi9jb25maWcnOwppbXBvcnQgeyBhc3NlcnQgfSBmcm9tICcuLi9saWIvYXNzZXJ0JzsKaW1wb3J0IHsgRW1pdHRlciB9IGZyb20gJy4uL2xpYi9lbWl0dGVyJzsKaW1wb3J0IHsgV2ViUlRDUGVlciB9IGZyb20gJy4vd2VicnRjLXBlZXInOwoKdmFyIGxvZyA9IHJlcXVpcmUoJ2RlYnVnJykoJ2FwcDp3ZWJydGMnKTsgLy8gSGFuZGxlcyBtdWx0aXBsZSBjb25uZWN0aW9ucywgb25lIHRvIGVhY2ggcGVlcgoKCmV4cG9ydCB2YXIgV2ViUlRDID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfRW1pdHRlcikgewogIF9pbmhlcml0cyhXZWJSVEMsIF9FbWl0dGVyKTsKCiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihXZWJSVEMpOwoKICBfY3JlYXRlQ2xhc3MoV2ViUlRDLCBudWxsLCBbewogICAga2V5OiAiaXNTdXBwb3J0ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzU3VwcG9ydGVkKCkgewogICAgICByZXR1cm4gV2ViUlRDUGVlci5pc1N1cHBvcnRlZCgpOwogICAgfQogIH1dKTsKCiAgZnVuY3Rpb24gV2ViUlRDKCkgewogICAgdmFyIF90aGlzOwoKICAgIHZhciBfcmVmID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fSwKICAgICAgICB3cnRjID0gX3JlZi53cnRjLAogICAgICAgIF9yZWYkcm9vbSA9IF9yZWYucm9vbSwKICAgICAgICByb29tID0gX3JlZiRyb29tID09PSB2b2lkIDAgPyBudWxsIDogX3JlZiRyb29tLAogICAgICAgIF9yZWYkcGVlclNldHRpbmdzID0gX3JlZi5wZWVyU2V0dGluZ3MsCiAgICAgICAgcGVlclNldHRpbmdzID0gX3JlZiRwZWVyU2V0dGluZ3MgPT09IHZvaWQgMCA/IHt9IDogX3JlZiRwZWVyU2V0dGluZ3M7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFdlYlJUQyk7CgogICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJwZWVyQ29ubmVjdGlvbnMiLCB7fSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicGVlclNldHRpbmdzIiwge30pOwoKICAgIGFzc2VydChyb29tLCAncm9vbSBjYW5ub3QgYmUgZW1wdHknKTsKICAgIF90aGlzLnBlZXJTZXR0aW5ncyA9IHBlZXJTZXR0aW5nczsKICAgIGxvZygnd2VicnRjIHJlYWNoZXMgb3V0IHRvJywgU0lHTkFMX1NFUlZFUl9VUkwpOyAvLyBodHRwczovL3NvY2tldC5pby9kb2NzL2NsaWVudC1hcGkvCgogICAgX3RoaXMuaW8gPSBpbyhTSUdOQUxfU0VSVkVSX1VSTCwgey8vIHRyYW5zcG9ydHM6IFsnd2Vic29ja2V0J10sCiAgICB9KTsKICAgIGFzc2VydChfdGhpcy5pbywgInNob3VsZCBub3QgZmFpbCB0byByZWFjaCBvdXQgdG8gIi5jb25jYXQoU0lHTkFMX1NFUlZFUl9VUkwpKTsKCiAgICBfdGhpcy5pby5vbignY29ubmVjdCcsIGZ1bmN0aW9uICgpIHsKICAgICAgbG9nKCdjb25uZWN0JywgX3RoaXMuaW8uaWQpOwoKICAgICAgX3RoaXMuZW1pdCgnaW8nLCB7CiAgICAgICAgb25saW5lOiB0cnVlCiAgICAgIH0pOwoKICAgICAgX3RoaXMuZW1pdCgnY29ubmVjdCcpOwoKICAgICAgX3RoaXMuaW8uZW1pdCgnam9pbicsIHsKICAgICAgICByb29tOiByb29tCiAgICAgIH0pOwogICAgfSk7CgogICAgX3RoaXMuaW8ub24oJ2Rpc2Nvbm5lY3QnLCBmdW5jdGlvbiAoKSB7CiAgICAgIGxvZygnZGlzY29ubmVjdCcpOwoKICAgICAgX3RoaXMuZW1pdCgnaW8nLCB7CiAgICAgICAgb25saW5lOiBmYWxzZQogICAgICB9KTsKCiAgICAgIF90aGlzLmVtaXQoJ2Rpc2Nvbm5lY3QnKTsKICAgIH0pOwoKICAgIF90aGlzLmlvLm9uKCdyZW1vdmUnLCBmdW5jdGlvbiAoX3JlZjIpIHsKICAgICAgdmFyIGlkID0gX3JlZjIuaWQ7CiAgICAgIHZhciBwZWVyID0gX3RoaXMucGVlckNvbm5lY3Rpb25zW2lkXTsKCiAgICAgIGlmIChwZWVyKSB7CiAgICAgICAgcGVlci5jbG9zZSgpOwogICAgICAgIGRlbGV0ZSBfdGhpcy5wZWVyQ29ubmVjdGlvbnNbaWRdOwoKICAgICAgICBfdGhpcy51cGRhdGVTdGF0dXMoKTsKCiAgICAgICAgX3RoaXMuZW1pdCgnZGlzY29ubmVjdGVkJywgewogICAgICAgICAgcGVlcjogcGVlcgogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsgLy8gUmVjZWl2ZSBhbGwgb3RoZXIgY3VycmVudGx5IGF2YWlsYWJsZSBwZWVycwoKCiAgICBfdGhpcy5pby5vbignam9pbmVkJywgZnVuY3Rpb24gKF9yZWYzKSB7CiAgICAgIHZhciByb29tID0gX3JlZjMucm9vbSwKICAgICAgICAgIHBlZXJzID0gX3JlZjMucGVlcnM7CiAgICAgIHZhciBsb2NhbCA9IF90aGlzLmlvLmlkOwogICAgICBsb2coJ21lJywgbG9jYWwsIHJvb20sICdwZWVycycsIHBlZXJzKTsgLy8gV2Ugd2lsbCB0cnkgdG8gZXN0YWJsaXNoIGEgc2VwYXJhdGUgY29ubmVjdGlvbiB0byBhbGwgb2YgdGhlbQogICAgICAvLyBJZiB0aGUgbmV3IHBhcnRpY2lwYW50ICh1cykgaW5pdGlhdGVzIHRoZSBjb25uZWN0aW9ucywgdGhlIG90aGVycyBkbwogICAgICAvLyBub3QgbmVlZCB0byBnZXQgdXBkYXRlcyBhYm91dCBuZXcgcGVlcnMKCiAgICAgIF90aGlzLmlvLm9uKCdzaWduYWwnLCBmdW5jdGlvbiAoX3JlZjQpIHsKICAgICAgICB2YXIgZnJvbSA9IF9yZWY0LmZyb20sCiAgICAgICAgICAgIHRvID0gX3JlZjQudG8sCiAgICAgICAgICAgIHNpZ25hbCA9IF9yZWY0LnNpZ25hbCwKICAgICAgICAgICAgaW5pdGlhdG9yID0gX3JlZjQuaW5pdGlhdG9yOwogICAgICAgIC8vIGxvZygncmVjZWl2ZWQgc2lnbmFsJywgZnJvbSwgdG8gPT09IGxvY2FsLCBpbml0aWF0b3IpCiAgICAgICAgLy8gSWYgd2UgYXJlIG5vdCBhbHJlYWR5IGNvbm5lY3RlZCwgZG8gaXQgbm93CiAgICAgICAgdmFyIHBlZXIgPSBfdGhpcy5wZWVyQ29ubmVjdGlvbnNbZnJvbV07CgogICAgICAgIGlmICghcGVlcikgewogICAgICAgICAgcGVlciA9IF90aGlzLmhhbmRsZVBlZXIoewogICAgICAgICAgICByZW1vdGU6IGZyb20sCiAgICAgICAgICAgIGxvY2FsOiBsb2NhbCwKICAgICAgICAgICAgaW5pdGlhdG9yOiBmYWxzZSwKICAgICAgICAgICAgd3J0Yzogd3J0YwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBwZWVyLnNpZ25hbChzaWduYWwpOwoKICAgICAgICBfdGhpcy51cGRhdGVTdGF0dXMoKTsKICAgICAgfSk7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBlZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIHJlbW90ZSA9IHBlZXJzW2ldOwoKICAgICAgICBfdGhpcy5oYW5kbGVQZWVyKHsKICAgICAgICAgIHJlbW90ZTogcmVtb3RlLAogICAgICAgICAgbG9jYWw6IGxvY2FsLAogICAgICAgICAgaW5pdGlhdG9yOiB0cnVlLAogICAgICAgICAgd3J0Yzogd3J0YwogICAgICAgIH0pOwogICAgICB9CgogICAgICBfdGhpcy51cGRhdGVTdGF0dXMoKTsKICAgIH0pOwoKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhXZWJSVEMsIFt7CiAgICBrZXk6ICJmb3JFYWNoUGVlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZm9yRWFjaFBlZXIoZm4pIHsKICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnBlZXJDb25uZWN0aW9ucykuZm9yRWFjaChmbik7CiAgICB9CiAgfSwgewogICAga2V5OiAidXBkYXRlU3RhdHVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVTdGF0dXMoKSB7CiAgICAgIHZhciBzdGF0dXMgPSBPYmplY3QudmFsdWVzKHRoaXMucGVlckNvbm5lY3Rpb25zKS5tYXAoZnVuY3Rpb24gKHBlZXIpIHsKICAgICAgICB2YXIgYWN0aXZlID0gcGVlci5hY3RpdmUsCiAgICAgICAgICAgIGluaXRpYXRvciA9IHBlZXIuaW5pdGlhdG9yLAogICAgICAgICAgICBsb2NhbCA9IHBlZXIubG9jYWwsCiAgICAgICAgICAgIHJlbW90ZSA9IHBlZXIucmVtb3RlLAogICAgICAgICAgICBlcnJvciA9IHBlZXIuZXJyb3I7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGFjdGl2ZTogYWN0aXZlLAogICAgICAgICAgaW5pdGlhdG9yOiBpbml0aWF0b3IsCiAgICAgICAgICBsb2NhbDogbG9jYWwsCiAgICAgICAgICByZW1vdGU6IHJlbW90ZSwKICAgICAgICAgIGVycm9yOiBlcnJvciwKICAgICAgICAgIHBlZXI6IHBlZXIKICAgICAgICB9OwogICAgICB9KTsKICAgICAgdGhpcy5lbWl0KCdzdGF0dXMnLCB7CiAgICAgICAgc3RhdHVzOiBzdGF0dXMKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0UGVlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UGVlcihpZCkgewogICAgICByZXR1cm4gdGhpcy5wZWVyQ29ubmVjdGlvbnNbaWRdIHx8IG51bGw7CiAgICB9CiAgfSwgewogICAga2V5OiAiaGFuZGxlUGVlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlUGVlcigpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgX3JlZjUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9LAogICAgICAgICAgcmVtb3RlID0gX3JlZjUucmVtb3RlLAogICAgICAgICAgd3J0YyA9IF9yZWY1LndydGMsCiAgICAgICAgICBsb2NhbCA9IF9yZWY1LmxvY2FsLAogICAgICAgICAgX3JlZjUkaW5pdGlhdG9yID0gX3JlZjUuaW5pdGlhdG9yLAogICAgICAgICAgaW5pdGlhdG9yID0gX3JlZjUkaW5pdGlhdG9yID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY1JGluaXRpYXRvcjsKCiAgICAgIHZhciBwZWVyID0gbmV3IFdlYlJUQ1BlZXIoX29iamVjdFNwcmVhZCh7CiAgICAgICAgbG9jYWw6IGxvY2FsLAogICAgICAgIHJlbW90ZTogcmVtb3RlLAogICAgICAgIGluaXRpYXRvcjogaW5pdGlhdG9yLAogICAgICAgIHdydGM6IHdydGMKICAgICAgfSwgdGhpcy5wZWVyU2V0dGluZ3MpKTsKICAgICAgdGhpcy5wZWVyQ29ubmVjdGlvbnNbcmVtb3RlXSA9IHBlZXI7IC8vIFdlIHJlY2VpdmVkIHRoZSBsb2NhbCBzaWduYWwgKGkuZS4gbmV0d29yayBsb2NhdGlvbiBkZXNjcmlwdGlvbikgdGhhdAogICAgICAvLyB3ZSB3aWxsIG5vdyBzZW5kIHZpYSB3ZWIgc29ja2V0IHNpZ25hbGluZyBzZXJ2ZXIgdG8gdGhlIHJlbW90ZSBwZWVyCgogICAgICBwZWVyLm9uKCdzaWduYWwnLCBmdW5jdGlvbiAoc2lnbmFsKSB7CiAgICAgICAgLy8gbG9nKCdyZWNlaXZlZCBwZWVyIHNpZ25hbCcsIHJlbW90ZSkKICAgICAgICBfdGhpczIuaW8uZW1pdCgnc2lnbmFsJywgewogICAgICAgICAgZnJvbTogbG9jYWwsCiAgICAgICAgICB0bzogcmVtb3RlLAogICAgICAgICAgc2lnbmFsOiBzaWduYWwsCiAgICAgICAgICBpbml0aWF0b3I6IGluaXRpYXRvcgogICAgICAgIH0pOwogICAgICB9KTsgLy8gVGhlIGZ1bGwgY29ubmVjdGlvbiBpcyBlc3RhYmxpc2hlZCwgZnJvbSBub3cgb24gd2UgY2FuIGV4Y2hhbmdlIGRhdGEKCiAgICAgIHBlZXIub24oJ2Nvbm5lY3QnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyLmVtaXQoJ2Nvbm5lY3RlZCcsIHsKICAgICAgICAgIHBlZXI6IHBlZXIKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMyLnVwZGF0ZVN0YXR1cygpOwogICAgICB9KTsgLy8gQSBtZXNzYWdlIGZyb20gdGhlIHJlbW90ZSBwZWVyCgogICAgICBwZWVyLm9uKCdkYXRhJywgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAvLyBkZXByCiAgICAgICAgdmFyIF9KU09OJHBhcnNlID0gSlNPTi5wYXJzZShkYXRhKSwKICAgICAgICAgICAgdHlwZSA9IF9KU09OJHBhcnNlLnR5cGUsCiAgICAgICAgICAgIG1zZyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhfSlNPTiRwYXJzZSwgWyJ0eXBlIl0pOwoKICAgICAgICBfdGhpczIuZW1pdCh0eXBlLCBtc2cpOwogICAgICB9KTsKICAgICAgcGVlci5vbignbWVzc2FnZScsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgX3RoaXMyLmVtaXQoJ21lc3NhZ2UnLCBkYXRhKTsgLy8gQ2hhbm5lbCBjb21wYXQKCiAgICAgIH0pOwogICAgICBwZWVyLm9uKCdzdHJlYW0nLCBmdW5jdGlvbiAoXykgewogICAgICAgIHJldHVybiBfdGhpczIudXBkYXRlU3RhdHVzKCk7CiAgICAgIH0pOwogICAgICBwZWVyLm9uKCd0cmFjaycsIGZ1bmN0aW9uIChfKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi51cGRhdGVTdGF0dXMoKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBwZWVyOwogICAgfQogIH0sIHsKICAgIGtleTogInBvc3RNZXNzYWdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwb3N0TWVzc2FnZShkYXRhKSB7CiAgICAgIC8vIENoYW5uZWwgY29tcGF0CiAgICAgIHRoaXMuZm9yRWFjaFBlZXIoZnVuY3Rpb24gKHBlZXIpIHsKICAgICAgICBwZWVyLnBvc3RNZXNzYWdlKGRhdGEpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZW5kIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZW5kKHR5cGUpIHsKICAgICAgdmFyIG1zZyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgIC8vIGRlcHIKICAgICAgdGhpcy5wb3N0TWVzc2FnZShKU09OLnN0cmluZ2lmeShfb2JqZWN0U3ByZWFkKHt9LCBtc2csIHsKICAgICAgICB0eXBlOiB0eXBlCiAgICAgIH0pKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY2xvc2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICB0aGlzLmZvckVhY2hQZWVyKGZ1bmN0aW9uIChwZWVyKSB7CiAgICAgICAgcmV0dXJuIHBlZXIuY2xvc2UoKTsKICAgICAgfSk7CiAgICAgIHRoaXMucGVlckNvbm5lY3Rpb25zID0ge307CiAgICAgIHRoaXMuaW8uY2xvc2UoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjbGVhbnVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfY2xlYW51cCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAvLyBhd2FpdCBzdXBlci5jbGVhbnVwKCkKICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTsKCiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGNsZWFudXAoKSB7CiAgICAgICAgcmV0dXJuIF9jbGVhbnVwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBjbGVhbnVwOwogICAgfSgpCiAgfV0pOwoKICByZXR1cm4gV2ViUlRDOwp9KEVtaXR0ZXIpOw=="},{"version":3,"sources":["C:/Users/Brezgo-1098/Desktop/brezz/src/logic/webrtc.js"],"names":["io","SIGNAL_SERVER_URL","assert","Emitter","WebRTCPeer","log","require","WebRTC","isSupported","wrtc","room","peerSettings","on","id","emit","online","peer","peerConnections","close","updateStatus","peers","local","from","to","signal","initiator","handlePeer","remote","i","length","fn","Object","values","forEach","status","map","active","error","data","JSON","parse","type","msg","_","forEachPeer","postMessage","stringify"],"mappings":"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","sourcesContent":["// Copyright (c) 2020 Dirk Holtwick. All rights reserved. https://holtwick.de/copyright\n\nimport io from 'socket.io-client'\nimport { SIGNAL_SERVER_URL } from '../config'\nimport { assert } from '../lib/assert'\nimport { Emitter } from '../lib/emitter'\nimport { WebRTCPeer } from './webrtc-peer'\n\nconst log = require('debug')('app:webrtc')\n\n// Handles multiple connections, one to each peer\nexport class WebRTC extends Emitter {\n\n  peerConnections = {}\n  peerSettings = {}\n\n  static isSupported() {\n    return WebRTCPeer.isSupported()\n  }\n\n  constructor({\n                wrtc, // wrtc is used for unit testing via node.js\n                room = null,\n                peerSettings = {},\n              } = {}) {\n    super()\n    assert(room, 'room cannot be empty')\n\n    this.peerSettings = peerSettings\n\n    log('webrtc reaches out to', SIGNAL_SERVER_URL)\n\n    // https://socket.io/docs/client-api/\n    this.io = io(SIGNAL_SERVER_URL, {\n      // transports: ['websocket'],\n    })\n    assert(this.io, `should not fail to reach out to ${SIGNAL_SERVER_URL}`)\n\n    this.io.on('connect', () => {\n      log('connect', this.io.id)\n      this.emit('io', {\n        online: true,\n      })\n      this.emit('connect')\n      this.io.emit('join', { room })\n    })\n\n    this.io.on('disconnect', () => {\n      log('disconnect')\n      this.emit('io', {\n        online: false,\n      })\n      this.emit('disconnect')\n    })\n\n    this.io.on('remove', ({ id }) => {\n      let peer = this.peerConnections[id]\n      if (peer) {\n        peer.close()\n        delete this.peerConnections[id]\n        this.updateStatus()\n        this.emit('disconnected', { peer })\n      }\n    })\n\n    // Receive all other currently available peers\n    this.io.on('joined', ({ room, peers }) => {\n      const local = this.io.id\n      log('me', local, room, 'peers', peers)\n\n      // We will try to establish a separate connection to all of them\n      // If the new participant (us) initiates the connections, the others do\n      // not need to get updates about new peers\n      this.io.on('signal', ({ from, to, signal, initiator }) => {\n        // log('received signal', from, to === local, initiator)\n        // If we are not already connected, do it now\n        let peer = this.peerConnections[from]\n        if (!peer) {\n          peer = this.handlePeer({\n            remote: from,\n            local,\n            initiator: false,\n            wrtc,\n          })\n        }\n        peer.signal(signal)\n        this.updateStatus()\n      })\n\n      for (let i = 0; i < peers.length; i++) {\n        const remote = peers[i]\n        this.handlePeer({\n          remote,\n          local,\n          initiator: true,\n          wrtc,\n        })\n      }\n\n      this.updateStatus()\n    })\n  }\n\n  forEachPeer(fn) {\n    Object.values(this.peerConnections).forEach(fn)\n  }\n\n  updateStatus() {\n    let status = Object.values(this.peerConnections).map(peer => {\n      let { active, initiator, local, remote, error } = peer\n      return {\n        active, initiator, local, remote, error, peer,\n      }\n    })\n    this.emit('status', { status })\n  }\n\n  getPeer(id) {\n    return this.peerConnections[id] || null\n  }\n\n  handlePeer({ remote, wrtc, local, initiator = false } = {}) {\n    let peer = new WebRTCPeer({\n      local,\n      remote,\n      initiator,\n      wrtc,\n      ...this.peerSettings,\n    })\n\n    this.peerConnections[remote] = peer\n\n    // We received the local signal (i.e. network location description) that\n    // we will now send via web socket signaling server to the remote peer\n    peer.on('signal', signal => {\n      // log('received peer signal', remote)\n      this.io.emit('signal', {\n        from: local,\n        to: remote,\n        signal,\n        initiator,\n      })\n    })\n\n    // The full connection is established, from now on we can exchange data\n    peer.on('connect', () => {\n      this.emit('connected', { peer })\n      this.updateStatus()\n    })\n\n    // A message from the remote peer\n    peer.on('data', data => { // depr\n      let { type, ...msg } = JSON.parse(data)\n      this.emit(type, msg)\n    })\n\n    peer.on('message', data => {\n      this.emit('message', data)  // Channel compat\n    })\n\n    peer.on('stream', _ => this.updateStatus())\n    peer.on('track', _ => this.updateStatus())\n\n    return peer\n  }\n\n  postMessage(data) {  // Channel compat\n    this.forEachPeer(peer => {\n      peer.postMessage(data)\n    })\n  }\n\n  send(type, msg = {}) {  // depr\n    this.postMessage(JSON.stringify({ ...msg, type }))\n  }\n\n  close() {\n    this.forEachPeer(peer => peer.close())\n    this.peerConnections = {}\n    this.io.close()\n  }\n\n  async cleanup() {\n    // await super.cleanup()\n    this.close()\n  }\n\n}\n"]}]}