{"remainingRequest":"C:\\Users\\Brezgo-1098\\Desktop\\brezz\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\Brezgo-1098\\Desktop\\brezz\\src\\state.js","dependencies":[{"path":"C:\\Users\\Brezgo-1098\\Desktop\\brezz\\src\\state.js","mtime":1587032502000},{"path":"C:\\Users\\Brezgo-1098\\Desktop\\brezz\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Brezgo-1098\\Desktop\\brezz\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mcm9tIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zdGFydHMtd2l0aCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICJDOlxcVXNlcnNcXEJyZXpnby0xMDk4XFxEZXNrdG9wXFxicmV6elxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkM6XFxVc2Vyc1xcQnJlemdvLTEwOThcXERlc2t0b3BcXGJyZXp6XFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IHsgbWVzc2FnZXMgfSBmcm9tICcuL2xpYi9lbWl0dGVyJzsKaW1wb3J0IHsgc2V0dXBXZWJSVEMgfSBmcm9tICcuL2xvZ2ljL2Nvbm5lY3Rpb24nOwppbXBvcnQgeyBkZWZhdWx0QXVkaW9Db25zdHJhaW50cywgZGVmYXVsdFZpZGVvQ29uc3RyYWludHMsIGdldERldmljZXMsIGdldFVzZXJNZWRpYSB9IGZyb20gJy4vbG9naWMvc3RyZWFtJzsKCnZhciBsb2cgPSByZXF1aXJlKCdkZWJ1ZycpKCdhcHA6c3RhdGUnKTsKCmV4cG9ydCB2YXIgREVCVUcgPSBsb2NhdGlvbi5wb3J0LnRvU3RyaW5nKCkgPT09ICc4MDgwJyB8fCAhbG9jYXRpb24ucGF0aG5hbWUuc3RhcnRzV2l0aCgnL25nLycpOyAvLyBST09NCgp2YXIgcm9vbSA9IERFQlVHID8gJ2RldmVsb3BtZW50JyA6IGxvY2F0aW9uLnBhdGhuYW1lLnN1YnN0cignL25nLycubGVuZ3RoKTsgLy8gU1RBVEUKCmV4cG9ydCB2YXIgc3RhdGUgPSB7CiAgLy8gSUQgb2YgdGhpcyByb29tCiAgcm9vbTogcm9vbSwKICAvLyBMb2NhbCB1c2VycyBwZWVyIElECiAgcGVlcklEOiBudWxsLAogIC8vIElEcyBvZiBhbGwgY3VycmVudGx5IGFjdGl2ZSBXZWJSVEMgcGVlcnMKICBwZWVyczogW10sCiAgLy8gVmlkZW8gc3RyZWFtIG9mIHRoZSBsb2NhbCB1c2VyIHdpdGhvdXQgc291bmQKICBzdHJlYW06IG51bGwsCiAgc3RhdHVzOiB7fSwKICBibHVyOiBmYWxzZSwKICBiYW5kd2lkdGg6IGZhbHNlLAogIG11dGVWaWRlbzogZmFsc2UsCiAgbXV0ZUF1ZGlvOiBmYWxzZSwKICBkZXZpY2VWaWRlbzogbnVsbCwKICBkZXZpY2VBdWRpbzogbnVsbCwKICBkZXZpY2VzOiBbXQp9OwptZXNzYWdlcy5vbigndXBkYXRlU3RyZWFtJywgdXBkYXRlU3RyZWFtKTsKCmZ1bmN0aW9uIHVwZGF0ZVN0cmVhbSgpIHsKICBzdGF0ZS5zdHJlYW0uZ2V0QXVkaW9UcmFja3MoKS5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7CiAgICByZXR1cm4gdC5lbmFibGVkID0gIXN0YXRlLm11dGVBdWRpbzsKICB9KTsKICBzdGF0ZS5zdHJlYW0uZ2V0VmlkZW9UcmFja3MoKS5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7CiAgICByZXR1cm4gdC5lbmFibGVkID0gIXN0YXRlLm11dGVWaWRlbzsKICB9KTsKfQoKbWVzc2FnZXMub24oJ3N3aXRjaFZpZGVvJywgc3dpdGNoVmlkZW8pOwp2YXIgYmx1ckxpYjsKCmZ1bmN0aW9uIHN3aXRjaFZpZGVvKCkgewogIHJldHVybiBfc3dpdGNoVmlkZW8uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gX3N3aXRjaFZpZGVvKCkgewogIF9zd2l0Y2hWaWRlbyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgIHZhciBhdWRpbywgdmlkZW8sIGNvbnN0cmFpbnRzLCBzdHJlYW0sIHNob3dzRGVza3RvcCwgc3VjY2VzcywgdmlkZW9UcmFja3MsIGF1ZGlvVHJhY2tzOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBhdWRpbyA9IF9vYmplY3RTcHJlYWQoe30sIGRlZmF1bHRBdWRpb0NvbnN0cmFpbnRzKTsKCiAgICAgICAgICAgIGlmIChzdGF0ZS5kZXZpY2VBdWRpbykgewogICAgICAgICAgICAgIGF1ZGlvLmRldmljZUlkID0gc3RhdGUuZGV2aWNlQXVkaW87CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZpZGVvID0gX29iamVjdFNwcmVhZCh7fSwgZGVmYXVsdFZpZGVvQ29uc3RyYWludHMpOwoKICAgICAgICAgICAgaWYgKHN0YXRlLmRldmljZVZpZGVvKSB7CiAgICAgICAgICAgICAgdmlkZW8uZGV2aWNlSWQgPSBzdGF0ZS5kZXZpY2VWaWRlbzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3RyYWludHMgPSB7CiAgICAgICAgICAgICAgYXVkaW86IGF1ZGlvLAogICAgICAgICAgICAgIHZpZGVvOiB2aWRlbwogICAgICAgICAgICB9OwogICAgICAgICAgICBzaG93c0Rlc2t0b3AgPSBzdGF0ZS5kZXZpY2VWaWRlbyA9PT0gJ2Rlc2t0b3AnOwoKICAgICAgICAgICAgaWYgKCFzaG93c0Rlc2t0b3ApIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvZygnZGVza3RvcCcpOwogICAgICAgICAgICB2aWRlbyA9IHsKICAgICAgICAgICAgICB2aWRlbzogewogICAgICAgICAgICAgICAgY3Vyc29yOiAnYWx3YXlzJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExOwogICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXREaXNwbGF5TWVkaWEodmlkZW8pOwoKICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgIHN0cmVhbSA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNzsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE2OwogICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoY29uc3RyYWludHMpOwoKICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgIHN0cmVhbSA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgbG9nKCdTdHJlYW0nLCBzdHJlYW0sIGNvbnN0cmFpbnRzKTsKCiAgICAgICAgICAgIGlmICghc3RyZWFtKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ3OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzdWNjZXNzID0gdHJ1ZTsKICAgICAgICAgICAgdmlkZW9UcmFja3MgPSBzdHJlYW0uZ2V0VmlkZW9UcmFja3MoKTsKCiAgICAgICAgICAgIGlmIChzdGF0ZS5kZXZpY2VWaWRlbyAmJiAodmlkZW9UcmFja3MgPT09IG51bGwgfHwgdmlkZW9UcmFja3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHZpZGVvVHJhY2tzLmxlbmd0aCkgPD0gMCkgewogICAgICAgICAgICAgIHN0YXRlLmRldmljZVZpZGVvID0gbnVsbDsKICAgICAgICAgICAgICBzdWNjZXNzID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGF1ZGlvVHJhY2tzID0gc3RyZWFtLmdldEF1ZGlvVHJhY2tzKCk7CgogICAgICAgICAgICBpZiAoc3RhdGUuZGV2aWNlQXVkaW8gJiYgKGF1ZGlvVHJhY2tzID09PSBudWxsIHx8IGF1ZGlvVHJhY2tzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhdWRpb1RyYWNrcy5sZW5ndGgpIDw9IDApIHsKICAgICAgICAgICAgICBzdGF0ZS5kZXZpY2VBdWRpbyA9IG51bGw7CiAgICAgICAgICAgICAgc3VjY2VzcyA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc3VjY2VzcykgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyODsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI3OwogICAgICAgICAgICByZXR1cm4gc3dpdGNoVmlkZW8oKTsKCiAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dC5zZW50KTsKCiAgICAgICAgICBjYXNlIDI4OgogICAgICAgICAgICBsb2coJ2JsdXIgd2hhdD8nLCBzdGF0ZS5ibHVyLCBibHVyTGliKTsKCiAgICAgICAgICAgIGlmICghKHN0YXRlLmJsdXIgJiYgIXNob3dzRGVza3RvcCkpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChibHVyTGliKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM0OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzM7CiAgICAgICAgICAgIHJldHVybiBpbXBvcnQoCiAgICAgICAgICAgIC8qIHdlYnBhY2tDaHVua05hbWU6ICdibHVyJyAqLwogICAgICAgICAgICAnLi9sb2dpYy9ibHVyJyk7CgogICAgICAgICAgY2FzZSAzMzoKICAgICAgICAgICAgYmx1ckxpYiA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgY2FzZSAzNDoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM2OwogICAgICAgICAgICByZXR1cm4gYmx1ckxpYi5zdGFydEJsdXJUcmFuc2Zvcm0oc3RyZWFtKTsKCiAgICAgICAgICBjYXNlIDM2OgogICAgICAgICAgICBzdHJlYW0gPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICBBcnJheS5mcm9tKHN0cmVhbS5nZXRBdWRpb1RyYWNrcygpKS5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHN0cmVhbS5yZW1vdmVUcmFjayh0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGF1ZGlvVHJhY2tzLmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gc3RyZWFtLmFkZFRyYWNrKHQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQyOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDQxOgogICAgICAgICAgICBpZiAoYmx1ckxpYikgewogICAgICAgICAgICAgIGxvZygnc3RvcCBibHVyJyk7CiAgICAgICAgICAgICAgYmx1ckxpYi5zdG9wQmx1clRyYW5zZm9ybSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSA0MjoKICAgICAgICAgICAgc3RhdGUuc3RyZWFtID0gc3RyZWFtOwogICAgICAgICAgICB1cGRhdGVTdHJlYW0oKTsKICAgICAgICAgICAgbWVzc2FnZXMuZW1pdCgnc2V0TG9jYWxTdHJlYW0nLCBzdGF0ZS5zdHJlYW0pOwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDg7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNDc6CiAgICAgICAgICAgIGxvZygnU3RyZWFtIG5vdCBmb3VuZCcpOwoKICAgICAgICAgIGNhc2UgNDg6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZSk7CiAgfSkpOwogIHJldHVybiBfc3dpdGNoVmlkZW8uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gc2V0dXAoKSB7CiAgcmV0dXJuIF9zZXR1cC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBfc2V0dXAoKSB7CiAgX3NldHVwID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgIHZhciBzdHJlYW07CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDA7CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgcmV0dXJuIHNldHVwV2ViUlRDKHN0YXRlKTsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIGlmIChfY29udGV4dDIuc2VudCkgewogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYWxlcnQoJ1lvdXIgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IHRoZSByZXF1aXJlZCBXZWJSVEMgdGVjaG5vbG9naWVzLlxuXG5QbGVhc2UgcmVjb25uZWN0IHVzaW5nIGFuIHVwIHRvIGRhdGUgd2ViIGJyb3dzZXIuXG5cblRoYW5rcyBmb3IgeW91ciB1bmRlcnN0YW5kaW5nLicpOwogICAgICAgICAgICBsb2NhdGlvbi5hc3NpZ24oJy9uZy8nKTsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA5OwogICAgICAgICAgICByZXR1cm4gZ2V0VXNlck1lZGlhKCk7CgogICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICBzdHJlYW0gPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMjsKICAgICAgICAgICAgcmV0dXJuIGdldERldmljZXMoKTsKCiAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICBzdGF0ZS5kZXZpY2VzID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgIHN0YXRlLnN0cmVhbSA9IHN0cmVhbTsKICAgICAgICAgICAgdXBkYXRlU3RyZWFtKCk7CiAgICAgICAgICAgIG1lc3NhZ2VzLmVtaXQoJ3NldExvY2FsU3RyZWFtJywgc3RhdGUuc3RyZWFtKTsKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyMTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAxODsKICAgICAgICAgICAgX2NvbnRleHQyLnQwID0gX2NvbnRleHQyWyJjYXRjaCJdKDApOwogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFeGNlcHRpb246JywgX2NvbnRleHQyLnQwKTsKCiAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlMiwgbnVsbCwgW1swLCAxOF1dKTsKICB9KSk7CiAgcmV0dXJuIF9zZXR1cC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpzZXR1cCgpLnRoZW4oKTs="},{"version":3,"sources":["C:/Users/Brezgo-1098/Desktop/brezz/src/state.js"],"names":["messages","setupWebRTC","defaultAudioConstraints","defaultVideoConstraints","getDevices","getUserMedia","log","require","DEBUG","location","port","toString","pathname","startsWith","room","substr","length","state","peerID","peers","stream","status","blur","bandwidth","muteVideo","muteAudio","deviceVideo","deviceAudio","devices","on","updateStream","getAudioTracks","forEach","t","enabled","getVideoTracks","switchVideo","blurLib","audio","deviceId","video","constraints","showsDesktop","cursor","navigator","mediaDevices","getDisplayMedia","success","videoTracks","audioTracks","startBlurTransform","Array","from","removeTrack","addTrack","stopBlurTransform","emit","setup","alert","assign","console","error","then"],"mappings":"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","sourcesContent":["import { messages } from './lib/emitter'\nimport { setupWebRTC } from './logic/connection'\nimport { defaultAudioConstraints, defaultVideoConstraints, getDevices, getUserMedia } from './logic/stream'\n\nconst log = require('debug')('app:state')\n\nexport const DEBUG = location.port.toString() === '8080' || !location.pathname.startsWith('/ng/')\n\n// ROOM\n\nlet room = DEBUG ? 'development' : location.pathname.substr('/ng/'.length)\n\n// STATE\n\nexport let state = {\n\n  // ID of this room\n  room,\n\n  // Local users peer ID\n  peerID: null,\n\n  // IDs of all currently active WebRTC peers\n  peers: [],\n\n  // Video stream of the local user without sound\n  stream: null,\n\n  status: {},\n\n  blur: false,\n  bandwidth: false,\n\n  muteVideo: false,\n  muteAudio: false,\n\n  deviceVideo: null,\n  deviceAudio: null,\n\n  devices: [],\n}\n\nmessages.on('updateStream', updateStream)\n\nfunction updateStream() {\n  state.stream.getAudioTracks().forEach(t => t.enabled = !state.muteAudio)\n  state.stream.getVideoTracks().forEach(t => t.enabled = !state.muteVideo)\n}\n\nmessages.on('switchVideo', switchVideo)\n\nlet blurLib\n\nasync function switchVideo() {\n  let audio = {\n    ...defaultAudioConstraints,\n  }\n\n  if (state.deviceAudio) {\n    audio.deviceId = state.deviceAudio\n  }\n\n  let video = {\n    ...defaultVideoConstraints,\n  }\n\n  if (state.deviceVideo) {\n    video.deviceId = state.deviceVideo\n  }\n\n  let constraints = {\n    audio,\n    video,\n  }\n\n  let stream\n  const showsDesktop = state.deviceVideo === 'desktop'\n\n  if (showsDesktop) {\n    log('desktop')\n    video = {\n      video: {\n        cursor: 'always',\n      },\n    }\n    stream = await navigator.mediaDevices.getDisplayMedia(video)\n  } else {\n    stream = await navigator.mediaDevices.getUserMedia(constraints)\n  }\n  log('Stream', stream, constraints)\n  if (stream) {\n    let success = true\n    let videoTracks = stream.getVideoTracks()\n    if (state.deviceVideo && videoTracks?.length <= 0) {\n      state.deviceVideo = null\n      success = false\n    }\n    let audioTracks = stream.getAudioTracks()\n    if (state.deviceAudio && audioTracks?.length <= 0) {\n      state.deviceAudio = null\n      success = false\n    }\n\n    if (!success) {\n      return await switchVideo()\n    }\n\n    log('blur what?', state.blur, blurLib)\n    if (state.blur && !showsDesktop) {\n      if (!blurLib) {\n        blurLib = await import(/* webpackChunkName: 'blur' */ './logic/blur')\n      }\n      stream = await blurLib.startBlurTransform(stream)\n      Array.from(stream.getAudioTracks()).forEach(t => stream.removeTrack(t))\n      audioTracks.forEach(t => stream.addTrack(t))\n    } else if (blurLib) {\n      log('stop blur')\n      blurLib.stopBlurTransform()\n    }\n\n    state.stream = stream\n    updateStream()\n\n    messages.emit('setLocalStream', state.stream)\n\n  } else {\n    log('Stream not found')\n  }\n}\n\nasync function setup() {\n  try {\n\n    if (!await setupWebRTC(state)) {\n      alert('Your browser does not support the required WebRTC technologies.\\n\\nPlease reconnect using an up to date web browser.\\n\\nThanks for your understanding.')\n      location.assign('/ng/')\n      return\n    }\n\n    let stream = await getUserMedia()\n\n    // Safari getDevices only works immediately after getUserMedia (bug)\n    state.devices = await getDevices()\n\n    state.stream = stream\n    updateStream()\n\n    messages.emit('setLocalStream', state.stream)\n\n  } catch (err) {\n    console.error('Exception:', err)\n  }\n}\n\nsetup().then()\n"]}]}